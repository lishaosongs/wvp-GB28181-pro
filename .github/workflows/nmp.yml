name: Build Web CI

on:
  push:
    branches:
      - main  # 触发分支，可根据需要修改
  workflow_dispatch:  # 手动触发选项

jobs:
  build-and-package:
    runs-on: ubuntu-latest

    steps:
      # 检出代码
      - name: Checkout code
        uses: actions/checkout@v4  # 使用最新版本

      # 安装 Node.js（项目中使用 20.x，与官方配置一致）
      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20.x'

      # 安装依赖并构建前端
      - name: Install dependencies and build
        working-directory: ./web
        run: |
          npm install
          npm run build:prod  # 修正为正确的构建命令

      # 压缩构建结果（路径修正：补充静态目录斜杠）
      - name: Compress build artifacts
        run: |
          tar -czf web-dist.tar.gz src/main/resources/static/

      # 上传构建产物
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: web-dist
          path: web-dist.tar.gz
